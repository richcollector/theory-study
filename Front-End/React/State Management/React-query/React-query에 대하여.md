## React-Query

1. React QueryëŠ” React Applicationì—ì„œ ì„œë²„ ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜¤ê³ , ìºì‹±í•˜ë©°, ì§€ì†ì ìœ¼ë¡œ ë™ê¸°í™”í•˜ê³  ì—…ë°ì´íŠ¸í•˜ëŠ” ì‘ì—…ì„ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
2. ë³µì¡í•˜ê³  ì¥í™©í•œ ì½”ë“œê°€ í•„ìš”í•œ ë‹¤ë¥¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë°©ì‹ê³¼ ë‹¬ë¦¬ React Component ë‚´ë¶€ì—ì„œ ê°„ë‹¨í•˜ê³  ì§ê´€ì ìœ¼ë¡œ APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. ë” ë‚˜ì•„ê°€ React Queryì—ì„œ ì œê³µí•˜ëŠ” ìºì‹±, Window Focus Refetching ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ API ìš”ì²­ê³¼ ê´€ë ¨ëœ ë²ˆì¡í•œ ì‘ì—… ì—†ì´ â€œí•µì‹¬ ë¡œì§â€ì— ì§‘ì¤‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¦‰, React-QueryëŠ” í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê³¼ì • ì¤‘ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤ì„ í•´ê²°í•´ì¤€ë‹¤.

### ìºì‹±(Caching)

React-Queryì˜ ì¥ì  ì¤‘ í•˜ë‚˜ëŠ” ë°ì´í„°ë¥¼ ìºì‹±í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤.
ìºì‹±ì´ë€ íŠ¹ì • ë°ì´í„°ì˜ ë³µì‚¬ë³¸ì„ ì €ì¥í•˜ì—¬ ì´í›„ ë™ì¼í•œ ë°ì´í„°ì˜ ì¬ì ‘ê·¼ ì†ë„ë¥¼ ë†’ì´ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.

React-QueryëŠ” ìºì‹±ì„ í†µí•´ ë™ì¼í•œ ë°ì´í„°ì— ëŒ€í•œ ë°˜ë³µì ì¸ ë¹„ë™ê¸° ë°ì´í„° í˜¸ì¶œì„ ë°©ì§€í•˜ê³ , ì´ëŠ” ë¶ˆí•„ìš”í•œ API ì½œì„ ì¤„ì—¬ ì„œë²„ì— ëŒ€í•œ ë¶€í•˜ë¥¼ ì¤„ì´ëŠ” ì¢‹ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

- ìµœì‹  ë°ì´í„°ì˜ íŒë³„

  ì—¬ê¸°ì„œ ê¶ê¸ˆí•œ ê²ƒì€ ë°ì´í„°ê°€ ìµœì‹ ì˜ ê²ƒì¸ì§€ ì•„ë‹Œì§€ì— ëŒ€í•œ ê²ƒì…ë‹ˆë‹¤.

  ë§Œì¼ ì„œë²„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ìºì‹±í•œ í›„, ì‹¤ì œ ì„œë²„ ë°ì´í„°ë¥¼ í™•ì¸í–ˆì„ ë•Œ ì„œë²„ ìƒì—ì„œ ë°ì´í„°ì˜ ìƒíƒœê°€ ë³€ê²½ë˜ì–´ìˆë‹¤ë©´, ì‚¬ìš©ìëŠ” ì‹¤ì œ ë°ì´í„°ê°€ ì•„ë‹Œ ë³€ê²½ ì „ì˜ ë°ì´í„°ë¥¼ ë°”ë¼ë³¼ ìˆ˜ë°–ì— ì—†ê²Œ ë©ë‹ˆë‹¤. ì´ëŠ” ì‚¬ìš©ìì—ê²Œ ì˜ëª»ëœ ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” ì—ëŸ¬ë¥¼ ë‚³ìŠµë‹ˆë‹¤.

ì°¸ê³ ë¡œ, React-Queryì—ì„œëŠ” ìµœì‹ ì˜ ë°ì´í„°ë¥¼ freshí•œ ë°ì´í„°, ê¸°ì¡´ì˜ ë°ì´í„°ë¥¼ staleí•œ ë°ì´í„°ë¼ê³  ë§í•©ë‹ˆë‹¤.

- ë°ì´í„°ì˜ ê°±ì‹ 

  ìœ„ì™€ ê°™ì€ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ” ì¢‹ì€ ìºì‹± ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ëŠ” ê²ƒì€ ê²°êµ­ í•„ìš”í•œ ìƒí™©ì— ì ì ˆí•˜ê²Œ ë°ì´í„°ë¥¼ ê°±ì‹ í•´ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ë§ê³¼ ê°™ìŠµë‹ˆë‹¤.

  - í™”ë©´ì„ ë³´ê³  ìˆì„ ë•Œ
  - í˜ì´ì§€ì˜ ì „í™˜ì´ ì¼ì–´ë‚¬ì„ ë•Œ
  - í˜ì´ì§€ ì „í™˜ ì—†ì´ ì´ë²¤íŠ¸ê°€ ë°œìƒí•´ ë°ì´í„°ë¥¼ ìš”ì²­í•  ë•Œ

í¬ê²Œ ë³´ë©´ ìœ„ì˜ 3ê°€ì§€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ React-Queryì—ì„œëŠ” ê¸°ë³¸ì ì¸ ì•„ë˜ì˜ ì˜µì…˜ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤.

```js
refetchOnWindowFocus, //default: true
refetchOnMount, //default: true
refetchOnReconnect, //default: true
staleTime, //default: 0
cacheTime, //default: 5ë¶„ (60 _ 5 _ 1000)
```

ìœ„ì˜ ì˜µì…˜ë“¤ì„ í†µí•´ ìš°ë¦¬ëŠ” React-Queryê°€ ì–´ë–¤ ì‹œì ì— ë°ì´í„°ë¥¼ Refetchingí•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ë¸Œë¼ìš°ì €ì— í¬ì»¤ìŠ¤ê°€ ë“¤ì–´ì˜¨ ê²½ìš°(refetchOnWindowFocus)
- ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ê°€ ë°œìƒí•œ ê²½ìš°(refetchOnMount)
- ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²°ì´ ë°œìƒí•œ ê²½ìš°(refetchOnReconnect)

#### staleTime? cacheTime ?

- staleTime

  ë°ì´í„°ê°€ fresh â†’ stale ìƒíƒœë¡œ ë³€ê²½ë˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì…ë‹ˆë‹¤.
  fresh ìƒíƒœì¼ ë•ŒëŠ” Refetch íŠ¸ë¦¬ê±° (ìœ„ì˜ 3ê°€ì§€ ê²½ìš°)ê°€ ë°œìƒí•´ë„ Refetchê°€ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  ê¸°ë³¸ê°’ì´ 0ì´ë¯€ë¡œ ë”°ë¡œ ì„¤ì •í•´ì£¼ì§€ ì•ŠëŠ”ë‹¤ë©´ Refetch íŠ¸ë¦¬ê±°ê°€ ë°œìƒí–ˆì„ ë•Œ ë¬´ì¡°ê±´ Refetchê°€ ë°œìƒí•©ë‹ˆë‹¤.

- cacheTime

  cacheTimeì€ ë°ì´í„°ê°€ inactiveí•œ ìƒíƒœì¼ ë•Œ ìºì‹±ëœ ìƒíƒœë¡œ ë‚¨ì•„ìˆëŠ” ì‹œê°„ì…ë‹ˆë‹¤.
  íŠ¹ì • ì»´í¬ë„ŒíŠ¸ê°€ unmount(í˜ì´ì§€ ì „í™˜ ë“±ìœ¼ë¡œ í™”ë©´ì—ì„œ ì‚¬ë¼ì§ˆ ë•Œ) ë˜ë©´ ì‚¬ìš©ëœ ë°ì´í„°ëŠ” inactiveìƒíƒœë¡œ ë°”ë€Œê³ , ì´ë•Œ ë°ì´í„°ëŠ” cacheTimeë§Œí¼ ìœ ì§€ë©ë‹ˆë‹¤.
  cacheTime ì´í›„ ë°ì´í„°ëŠ” ê°€ë¹„ì§€ ì½œë ‰í„°ë¡œ ìˆ˜ì§‘ë˜ì–´ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œë©ë‹ˆë‹¤.
  ë§Œì¼ cacheTimeì´ ì§€ë‚˜ì§€ ì•Šì•˜ëŠ”ë° í•´ë‹¹ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ì‹œ mountë˜ë©´, ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ fetchí•´ì˜¤ëŠ” ë™ì•ˆ ìºì‹±ëœ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
  ì¦‰, ìºì‹±ëœ ë°ì´í„°ë¥¼ ê³„ì† ë³´ì—¬ì£¼ëŠ”ê²Œ ì•„ë‹ˆë¼ fetchí•˜ëŠ” ë™ì•ˆ ì„ì‹œë¡œ ë³´ì—¬ì¤€ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
  ì´ì™¸ì—ë„ ì‚¬ìš©ìê°€ íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ Refetchingì„ í•˜ë„ë¡ ì„¤ì •í•´ì¤„ ìˆ˜ ìˆë‹¤. React-Queryì˜ ì´ëŸ¬í•œ ê¸°ëŠ¥ë“¤ì„ í†µí•´ ì‚¬ìš©ìëŠ” ì–¸ì œë‚˜ ìµœì„ ì˜ ë°ì´í„°ë¥¼ ì œê³µë°›ê²Œ ë©ë‹ˆë‹¤.

### Client ë°ì´í„°ì™€ Server ë°ì´í„° ê°„ì˜ ë¶„ë¦¬

í”„ë¡œì íŠ¸ì˜ ê·œëª¨ê°€ ì»¤ì§€ê³  ê´€ë¦¬í•´ì•¼í•  ë°ì´í„°ê°€ ë„˜ì¹˜ë‹¤ ë³´ë©´, Client ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë°ì´í„°ì™€ Server ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë°ì´í„°ê°€ ë¶„ë¦¬ë  í•„ìš”ì„±ì„ ëŠë‚ë‹ˆë‹¤.

- Client Data

  ëª¨ë‹¬ ê´€ë ¨ ë°ì´í„°, í˜ì´ì§€ ê´€ë ¨ ë°ì´í„° ë“±ë“±..

- Server Data

  ì‚¬ìš©ì ì •ë³´, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê´€ë ¨ ì •ë³´ ë“±ë“±..

ê°„ë‹¨í•˜ê²Œ ìƒê°í•´ì„œ ë¹„ë™ê¸° API í˜¸ì¶œì„ í†µí•´ ë¶ˆëŸ¬ì˜¤ëŠ” ë°ì´í„°ë“¤ì„ Server ë°ì´í„°ë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹¤ì œ Client ë°ì´í„°ì˜ ê²½ìš° Redux, Recoil, mobXì™€ ê°™ì€ ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ í†µí•´ ì˜ ê´€ë¦¬ë˜ì–´ì˜¤ê³  ìˆìœ¼ë‚˜, ë¬¸ì œëŠ” ì´ëŸ¬í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ Server ë°ì´í„°ê¹Œì§€ë„ ê´€ë¦¬ë¥¼ í•´ì•¼í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ìœ„ì˜ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ë„ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì´ ì¡´ì¬í•˜ê±°ë‚˜, ì„œë“œ íŒŒí‹°ë¥¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§€ì›í•˜ëŠ” ê²ƒì´ ë§ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ë“¤ì´ Client ë°ì´í„°ì™€ Server ë°ì´í„°ë¥¼ ì™„ë²½íˆ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬ì— ìš©ì´í•˜ë„ë¡ ì¶©ë¶„í•œ ê¸°ëŠ¥ì´ ì§€ì›ëœë‹¤ê³  ë³´ê¸° ì–´ë µìŠµë‹ˆë‹¤. **ì¦‰ ìœ„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì€ Client ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ë¡œì§ì´ ì§‘ì¤‘ë˜ì–´ìˆê¸° ë•Œë¬¸ì—, Server ë°ì´í„°ê¹Œì§€ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸°ì—ëŠ” í•œê³„ê°€ ë¶„ëª…í•©ë‹ˆë‹¤.**

React-QueryëŠ” ì´ëŸ¬í•œ ë¬¸ì œì— ëŒ€í•œ í•´ê²°ì±… ë˜í•œ ì œì‹œí•´ ì£¼ëŠ”ë°, ì•„ë˜ ì½”ë“œë¥¼ ì‚´í´ë³´ì.

```jsx
const { data, isLoading } = useQueries(
  ["unique-key"],
  () => {
    return api({
      url: URL,
      method: "GET",
    });
  },
  {
    onSuccess: (data) => {
      // dataë¡œ ì´ê²ƒì €ê²ƒ í•˜ëŠ” ë¡œì§
    },
  },
  {
    onError: (error) => {
      // errorë¡œ ì´ê²ƒì €ê²ƒ í•˜ëŠ” ë¡œì§
    },
  }
);
```

ì˜ˆì‹œì—ì„œëŠ” ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ìœ„ì™€ ê°™ì€ ë¡œì§ì„ í†µí•´ Server ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆëŠ”ë°, ì´ë•Œ onSuccessì™€ onError í•¨ìˆ˜ë¥¼ í†µí•´ fetch ì„±ê³µê³¼ ì‹¤íŒ¨ì— ëŒ€í•œ ë¶„ê¸°ë¥¼ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” Server ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê³¼ì •ì—ì„œ êµ¬í˜„í•´ì•¼í•  ì¶”ê°€ì ì¸ ì„¤ì •ë“¤ì„ ì§„í–‰í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì´ì•¼ê¸°ì…ë‹ˆë‹¤.

ì¦‰, Client ë°ì´í„°ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ê´€ë¦¬í•˜ê³ , Server ë°ì´í„°ëŠ” React-Queryê°€ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°ë¼ê³  ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìš°ë¦¬ëŠ” Client ë°ì´í„°ì™€ Server ë°ì´í„°ë¥¼ ì˜¨ì „í•˜ê²Œ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¬¼ë¡  ì—¬ê¸°ì„œ React-Queryê°€ ê°€ì ¸ì˜¨ Server ë°ì´í„°ë¥¼ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ì „ì—­ ìƒíƒœë¡œ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆëŠ” ê²ƒë„ ì‚¬ì‹¤ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ refetchê°€ ì—¬ëŸ¬ ë²ˆ ì¼ì–´ë‚˜ëŠ” ìƒí™©ì— ë§¤ë²ˆ Server ë°ì´í„°ë¥¼ ì „ì—­ ìƒíƒœë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì˜³ì€ì§€ íŒë‹¨í•˜ëŠ” ê²ƒë„ ìš°ë¦¬ì˜ ëª«ì…ë‹ˆë‹¤. ê°œë°œí•˜ëŠ” ì„œë¹„ìŠ¤ì˜ ìƒí™©ì— ë§ê²Œ ì˜ ì„ íƒí•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.

### ëŒ€í‘œì ì¸ ê¸°ëŠ¥ë“¤

ê¸°ë³¸ì ìœ¼ë¡œ GET ì—ëŠ” useQueryê°€, PUT, UPDATE, DELETEì—ëŠ” useMutationì´ ì‚¬ìš©ë©ë‹ˆë‹¤.

- useQuery

  ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ unique keyë¥¼ í¬í•¨í•œ ë°°ì—´ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤. ì´í›„ ë™ì¼í•œ ì¿¼ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
  ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë“¤ì–´ê°€ëŠ” ë°°ì—´ì˜ ì²« ìš”ì†ŒëŠ” unique keyë¡œ ì‚¬ìš©ë˜ê³ , ë‘ ë²ˆì§¸ ìš”ì†Œë¶€í„°ëŠ” query í•¨ìˆ˜ ë‚´ë¶€ì˜ íŒŒë¼ë¯¸í„°ë¡œ ê°’ë“¤ì´ ì „ë‹¬ë©ë‹ˆë‹¤.
  ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ ì‹¤ì œ í˜¸ì¶œí•˜ê³ ì í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤. ì´ë•Œ í•¨ìˆ˜ëŠ” Promiseë¥¼ ë°˜í™˜í•˜ëŠ” í˜•íƒœì—¬ì•¼ í•©ë‹ˆë‹¤.
  ìµœì¢… ë°˜í™˜ ê°’ì€ APIì˜ ì„±ê³µ, ì‹¤íŒ¨ ì—¬ë¶€, ë°˜í™˜ê°’ì„ í¬í•¨í•œ ê°ì²´ì…ë‹ˆë‹¤.

```jsx
import {
  QueryClient,
  QueryClientProvider,
  useQuery,
} from "@tanstack/react-query";

const queryClient = new QueryClient();

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  );
}

function Example() {
  const { isLoading, error, data } = useQuery({
    queryKey: ["repoData"],
    queryFn: () =>
      fetch("https://api.github.com/repos/tannerlinsley/react-query").then(
        (res) => res.json()
      ),
  });

  if (isLoading) return "Loading...";

  if (error) return "An error has occurred: " + error.message;

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>ğŸ‘€ {data.subscribers_count}</strong>{" "}
      <strong>âœ¨ {data.stargazers_count}</strong>{" "}
      <strong>ğŸ´ {data.forks_count}</strong>
    </div>
  );
}
```

useQuery í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ë¥¼ ë³´ë©´ isLoading ì„ í†µí•´ ë¡œë”© ì—¬ë¶€ë¥¼, error ë¥¼ í†µí•´ ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ë¥¼, dataë¥¼ í†µí•´ ì„±ê³µ ì‹œ ë°ì´í„°ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
isLoadingê³¼ errorë¥¼ ì´ìš©í•˜ì—¬ ê° ìƒí™© ë³„ ë¶„ê¸°ë¥¼ ì‰½ê²Œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- useQuery ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰

  enabled ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë¹„ë™ê¸° í•¨ìˆ˜ì¸ useQueryë¥¼ ë™ê¸°ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
  useQueryì˜ ì„¸ ë²ˆì§¸ ì¸ìë¡œ ë‹¤ì–‘í•œ ì˜µì…˜ ê°’ë“¤ì´ ë“¤ì–´ê°€ëŠ”ë°, ì—¬ê¸°ì„œ enabledì— ê°’ì„ ëŒ€ì…í•˜ë©´ í•´ë‹¹ ê°’ì´ trueì¼ ë•Œ useQueryë¥¼ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

```jsx
const { data: todoList, error, isFetching } = useQuery("todos", fetchTodoList);
const {
  data: nextTodo,
  error,
  isFetching,
} = useQuery("nextTodos", fetchNextTodoList, {
  enabled: !!todoList, // trueê°€ ë˜ë©´ fetchNextTodoListë¥¼ ì‹¤í–‰í•œë‹¤
});
```

- useQueries

  ì—¬ëŸ¬ ê°œì˜ useQueryë¥¼ í•œ ë²ˆì— ì‹¤í–‰í•˜ê³ ì í•˜ëŠ” ê²½ìš°, ê¸°ì¡´ì˜ Promise.all()ì²˜ëŸ¼ ë¬¶ì–´ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.

```jsx
const results = useQueries({
  queries: [
    { queryKey: ["post", 1], queryFn: fetchPost, staleTime: Infinity },
    { queryKey: ["post", 2], queryFn: fetchPost, staleTime: Infinity },
  ],
});

// ë‘ queryì— ëŒ€í•œ ë°˜í™˜ê°’ì´ ë°°ì—´ë¡œ ë¬¶ì—¬ ë°˜í™˜ëœë‹¤!!
```

- useMutation

  ìœ„ì—ì„œ ì–¸ê¸‰í•œ ê²ƒì²˜ëŸ¼ PUT, UPDATE, DELETE ì™€ ê°™ì´ ê°’ì„ ë³€ê²½í•  ë•Œ ì‚¬ìš©í•˜ëŠ” APIì…ë‹ˆë‹¤. ë°˜í™˜ê°’ì€ useQueryì™€ ë™ì¼í•©ë‹ˆë‹¤.

```jsx
function App() {
  const mutation = useMutation({
    mutationFn: (newTodo) => {
      return axios.post("/todos", newTodo);
    },
  });

  return (
    <div>
      {mutation.isLoading ? (
        "Adding todo..."
      ) : (
        <>
          {mutation.isError ? (
            <div>An error occurred: {mutation.error.message}</div>
          ) : null}

          {mutation.isSuccess ? <div>Todo added!</div> : null}

          <button
            onClick={() => {
              mutation.mutate({ id: new Date(), title: "Do Laundry" });
            }}
          >
            Create Todo
          </button>
        </>
      )}
    </div>
  );
}
```

ìœ„ì˜ ì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ ë°˜í™˜ê°’ì€ useQueryì™€ ë™ì¼í•˜ì§€ë§Œ, ì²˜ìŒ ì‚¬ìš© ì‹œì— post ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë„£ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤. **ì´ë•Œ useMutationì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ë“¤ì–´ê°€ê³ , ë‘ ë²ˆì§¸ ì¸ìë¡œ ìƒí™© ë³„ ë¶„ê¸° ì„¤ì •ì´ ë“¤ì–´ê°„ë‹¤ëŠ” ì ì´ ì°¨ì´ì…ë‹ˆë‹¤.**

ì‹¤ì œ ì‚¬ìš© ì‹œì—ëŠ” mutation.mutate ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ê³ , ì²« ë²ˆì§¸ ì¸ìë¡œ API í˜¸ì¶œ ì‹œì— ì „ë‹¬í•´ì£¼ì–´ì•¼í•˜ëŠ” ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.

### SWRê³¼ì˜ ë¹„êµ

React-Queryê°€ ì¥ì ë§Œ ë³´ìœ í•˜ê³  ìˆë‹¤ë©´, ë‹¤ë¥¸ ê²½ìŸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ì‚´ì•„ë‚¨ê¸° ì–´ë ¤ìš¸ ê²ƒì…ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ React-Queryê°€ ê°€ì§€ëŠ” ë‹¨ì ì„ React-Queryë§Œí¼ ëŒ€í‘œì ì¸ Data fetching ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ SWRê³¼ ë¹„êµí•´ë³´ê² ìŠµë‹ˆë‹¤.

- SWR

```jsx
import useSWR from "swr";

const App = () => (
  <div>
    <SWRProfile />
  </div>
);

const SWRProfile = () => {
  const { data, error } = useSWR(
    "https://61b88c9d64e4a10017d19053.mockapi.io/user",
    (url) => fetch(url).then((res) => res.json())
  );

  if (error) return <div>failed to load</div>;
  if (!data) return <div>loading...</div>;

  return <Profile library="SWR" data={data} />;
};

const Profile = ({ library, data }) => (
  <div>
    <h1>Users from {library}</h1>
    {data.map((user) => (
      <p>
        {user.level} developer <strong>{user.name}</strong>
      </p>
    ))}
  </div>
);

export default App;
```

- React-Query

```jsx
import { QueryClient, QueryClientProvider, useQuery } from "react-query";

const queryClient = new QueryClient();
const url = "https://61b88c9d64e4a10017d19053.mockapi.io/user";

const App = () => (
  <div>
    <QueryClientProvider client={queryClient}>
      <ReactQueryProfile />
    </QueryClientProvider>
  </div>
);

const ReactQueryProfile = () => {
  const { isLoading, error, data, isFetching } = useQuery("users", () =>
    fetch("https://61b88c9d64e4a10017d19053.mockapi.io/user").then((res) =>
      res.json()
    )
  );

  if (error) return <div>failed to load</div>;
  if (isLoading) return <div>loading...</div>;

  return <Profile library="React Query" data={data} />;
};

const Profile = ({ library, data }) => (
  <div>
    <h1>Users from {library}</h1>
    {data.map((user) => (
      <p>
        {user.level} developer <strong>{user.name}</strong>
      </p>
    ))}
  </div>
);

export default App;
```

ìœ„ ì½”ë“œë¥¼ í†µí•´ ì•Œì•„ë³¼ ìˆ˜ ìˆëŠ” SWRì˜ ê°•ì ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- Provider

  SWRì€ ë³„ë„ì˜ Provider ì—†ì´ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë‚˜, React-QueryëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¸ëŠ” ë³„ë„ì˜ Providerê°€ í•„ìš”í•´ ì´ë¥¼ ì„¤ì •í•´ì£¼ì–´ì•¼í•œë‹¤. ì‚¬ì‹¤ ì´ê²Œ ê·€ì°®ê²Œ ë‹¤ê°€ì˜¤ëŠ” ì •ë„ëŠ” ì•„ë‹ˆì§€ë§Œ, ì´ˆê¸° ì„¤ì •ì„ í•˜ë‚˜ ë” í•´ì£¼ì–´ì•¼í•œë‹¤ëŠ” ì ì´ ìˆìŠµë‹ˆë‹¤.

- Fetcher

  useSWR, useQuery ëª¨ë‘ ë‘ ë²ˆì§¸ ì¸ìë¡œ fetcherë¥¼ ë°›ìŠµë‹ˆë‹¤. ì´ë•Œ SWRì˜ ê²½ìš° ì²« ë²ˆì§¸ ì¸ìë¡œ urlì„ ë°›ê³ , ë‘ ë²ˆì§¸ ì¸ìì¸ fetcherì— ì²« ë²ˆì§¸ ì¸ìë¡œ ë°›ì€ urlì„ ë„˜ê²¨ì£¼ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë˜í•œ SWRì€ ì „ì—­ ì„¤ì •ì„ í†µí•´ fetcherë¥¼ ì •í•´ë‘˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ React-QueryëŠ” fetcherì— urlì„ ì§ì ‘ ì „ë‹¬í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

### React-Queryê°€ ê°€ì§€ëŠ” ì¥ì 

- Devtools

  React-Queryì—ì„œëŠ” ê³µì‹ì ìœ¼ë¡œ react-query/devtoolsë¥¼ í†µí•´ Devtoolì„ ì§€ì›í•©ë‹ˆë‹¤. ê°œë°œ ëª¨ë“œì—ì„œë§Œ ì‚¬ìš©í•˜ë©°, devtoolsë¥¼ í†µí•´ ì¢€ ë” í™•ì‹¤í•˜ê²Œ ë°ì´í„°ì˜ íë¦„ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

SWR ë˜í•œ devtoolsë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë‚˜, ì„œë“œ íŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ì•¼í•©ë‹ˆë‹¤.

- ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„

  SWRê³¼ React-Query ëª¨ë‘ ë¬´í•œ ìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•˜ëŠ” ë° í•„ìš”í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ SWRë¡œ ë¬´í•œ ìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•˜ë ¤ë©´ ìœ ì €ê°€ ë¶€ê°€ì ì¸ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼í•˜ëŠ” ë°˜ë©´,
React-Queryì—ëŠ” getPreviousPageParam, fetchPreviousPage, hasPreviousPage ì™€ ê°™ì€ ë‹¤ì–‘í•œ í˜ì´ì§€ ê´€ë ¨ ê¸°ëŠ¥ì´ ì¡´ì¬í•´ ì´ë¥¼ ì´ìš©í•´ ë¬´í•œ ìŠ¤í¬ë¡¤ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Selectors

  React-Queryì—ì„œëŠ” select í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ raw dataë¡œë¶€í„° ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ì—¬ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```jsx
import { useQuery } from "react-query";

function User() {
  const { data } = useQuery("user", fetchUser, {
    select: (user) => user.username,
  });
  return <div>Username: {data}</div>;
}
```

ìœ„ì˜ ì˜ˆì‹œì²˜ëŸ¼ select ë¥¼ í†µí•´ ì›í•˜ëŠ” ë°ì´í„°ì— ì ‘ê·¼í•œ ë’¤ ì¶”ì¶œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

- Data Optimization

  SWRê³¼ ë‹¤ë¥´ê²Œ React-queryëŠ” ì¿¼ë¦¬ê°€ ì—…ë°ì´íŠ¸ë  ë•Œë§Œ refetchë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ë˜í•œ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° í•œë²ˆì— ë¬¶ì–´ ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë Œë”ë§ í¼í¬ë¨¼ìŠ¤ë¥¼ ê°œì„ í•´ì¤ë‹ˆë‹¤.

- Garbage Collection

  React-QueryëŠ” ì§€ì •ëœ ì‹œê°„(ê¸°ë³¸ 5ë¶„)ë™ì•ˆ ì¿¼ë¦¬ê°€ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìë™ìœ¼ë¡œ ë©”ëª¨ë¦¬ í•´ì œë¥¼ í•˜ëŠ” Auto Garbage Collectionì„ í†µí•´ ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬í•´ì¤ë‹ˆë‹¤.

### v4ì—ì„œì˜ ë³€ê²½ì 

React-Query v4ì—ì„œëŠ” íŒ¨í‚¤ì§€ ì´ë¦„ë¶€í„° `@tanstack/react-query`ë¡œ ë³€ê²½ë˜ë©´ì„œ Reactì—ë§Œ êµ­í•œë˜ì§€ ì•Šì€ ë²”ìš© í”„ë¡ íŠ¸ì—”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤. ì¦‰ tanstackì´ë¼ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ í”„ë¡œì íŠ¸ í•˜ìœ„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ ê²ƒì…ë‹ˆë‹¤. ê³µì‹ë¬¸ì„œë„ tanstackì—ì„œ ì œê³µí•˜ê³  ìˆìœ¼ë‹ˆ í—·ê°ˆë¦¬ì§€ ì•Šë„ë¡ ì£¼ì˜í•©ì‹œë‹¤.

- ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë¦„ ë³€ê²½

  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë¦„ì´ ë³€ê²½ë˜ë©´ì„œ importë¥¼ í•  ë•Œ @tanstack/react-queryë¡œ ì§„í–‰í•´ì•¼í•œë‹¤. react-queryë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë”ëŠ” ì—†ìŠµë‹ˆë‹¤.

- Query keyì— ë°°ì—´ì„ ë„£ì–´ì£¼ì

  useQuery í›…ì„ ì‚¬ìš©í•˜ë©´ì„œ ì²« ë²ˆì§¸ ì¸ìë¡œ unique keyë¥¼ ì •í•´ì£¼ì—ˆëŠ”ë°, ì´ì œ í•´ë‹¹ ì…ë ¥ê°’ì´ í•˜ë‚˜ë§Œ ìˆë”ë¼ë„ ë¬´ì¡°ê±´ ë°°ì—´ì˜ í˜•íƒœë¥¼ ë„ì–´ì•¼ í•©ë‹ˆë‹¤.

  `useQuery('todos', fetchTodos) => useQuery(['todos'], fetchTodos)`

- useQueriesì— ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ ë„˜ê¸¸ ë•Œ queriesë¥¼ ëª…ì‹œ

  ê¸°ì¡´ì˜ ì½”ë“œì—ì„œëŠ” useQueriesë¥¼ ì‚¬ìš©í•  ë•Œ ì¸ìë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì¿¼ë¦¬ ì •ë³´ë¥¼ ë‹´ì€ ë°°ì—´ì„ ë³´ë‚´ì¤¬ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ì œëŠ” ì´ë¥¼ ë¬¶ì–´ì„œ queriesë¼ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.

  `useQueries([{ queryKey1, queryFn1, options1 }, { queryKey2, queryFn2, options2 }])` =>
  `useQueries({ queries: [{ queryKey1, queryFn1, options1 }, { queryKey2, queryFn2, options2 }] })`

- undefined ëŒ€ì‹  Errorë¥¼ ë°˜í™˜

  ë¹„ë™ê¸° í•¨ìˆ˜ë“¤ ì¤‘ì—ëŠ” queryê°€ ì˜ëª»ëœ ê²½ìš° ëª¨ì¢…ì˜ ì´ìœ ë¡œ ê²°ê³¼ê°’ì´ undefinedì¸ ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.

ì´ì „ê¹Œì§€ëŠ” ì´ëŸ¬í•œ ê²½ìš° ê·¸ì € ë°˜í™˜ê°’ undefinedë¥¼ ê·¸ëŒ€ë¡œ ìš°ë¦¬ì—ê²Œ ë³´ë‚´ì£¼ì—ˆëŠ”ë°, ì´ì œëŠ” React-Query ìì²´ì ìœ¼ë¡œ ì´ë¥¼ ê°ì§€í•˜ê³  ì´ëŸ° ê²½ìš° API í˜¸ì¶œì„ Failedë¼ê³  í‘œì‹œí•˜ê³  Errorë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ê°’ì´ ì—†ëŠ” ê²½ìš°ë„ Errorë¡œ ë¶„ê¸°í•´ì„œ ë³´ë‚´ì¤€ë‹¤ë‹ˆ, ì•„ì£¼ í¸ë¦¬í•œ ê¸°ëŠ¥ì´ë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì°¸ê³ ìë£Œ

- [[React-Query] React-Query ê°œë…ì¡ê¸°](https://velog.io/@kandy1002/React-Query-%ED%91%B9-%EC%B0%8D%EC%96%B4%EB%A8%B9%EA%B8%B0)
