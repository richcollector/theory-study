## 스레드 동기화

멀티스레드를 이용하는 프로그램에서 스레드 2개 이상이 공유 데이터에 접근하면 다양한 문제가 발생할 수 있습니다.
이러한 **멀티스레드 환경에서 발생하는 문제를 해결하기 위해 일련의 작업을 스레드 동기화(thread synchronization)라 합니다.** 윈도우 운영체제는 프로그래머가 상황에 따라 적절한 동기화 기법을 선택할 수 있도록 다양한 API 함수를 제공합니다.

- 윈도우 운영체제에서 사용할 수 있는 대표적인 스레드 동기화 기법

|               종류               |                                                 기능                                                  |
| :------------------------------: | :---------------------------------------------------------------------------------------------------: |
|   임계 영역(critical section)    |     공유자원에 대해 오직 한 스레드의 접근만 허용<br/>(한 프로세스에 속한 스레드 간에만 사용 가능)     |
|          뮤텍스(metex)           | 공유 자원에 대해 오직 한 스레드의 접근만 허용<br/>(서로 다른 프로세스에 속한 스레드 간에도 사용 가능) |
|          이벤트(event)           |                             사건 발생을 알려 대기 중인 스레드를 깨웁니다.                             |
|       세마포어(semaphore)        |     한정된 개수의 자원에 여러 스레드가 접근할 때, 자원을 사용할 수 있는 스레드 개수를 제한합니다.     |
| 대기 가능 타이머(waitable timer) |                            정해진 시간이 되면 대기 중인 스레드를 깨웁니다.                            |

### 스레드 동기화 기본 개념

스레드 동기화가 필요한 상황은 크게 다음 2가지 경우입니다.

- 둘 이상의 스레드가 공유 자원에 접근
- 한 스레드가 작업을 완료한 후, 기다리고 있는 다른 스레드에 알림

두 경우 모두 각 스레드가 독립적으로 실행하지 않고 다른 스레드와의 상호 작용을 토대로 자신의 작업을 진행한다는 특징이 있습니다. 스레드 동기화를 하려면 스레드가 상호작용해야 하므로 중간 매개체가 필요합니다. 두 스레드가 동시에 진행하면 안되는 상황이 있을 때, 두 스레드는 매개체를 통해 진행 가능 여부를 판단하고 이에 근거해 자신의 실행을 계속할지를 결정합니다.

윈도우 운영체제에서 이러한 **매개체 역할을 할 수 있는 것을 통틀어 동기화 객체(synchronization object)라고 합니다.**

### 동기화 객체

- Create\*()함수를 호출하면 커널(kernel: 운영체제의 핵심 부분을 뜻함) 메모리 영역에 동기화 객체가 생성되고, 이에 접근할 수 있는 핸들(HANDLE 타입)이 리턴됩니다.
- 평소에는 비신호 상태(non-signaled state)로 있다가 특정 조건이 만족되면 신호 상태(signaled state)가 된다. 비신호 상태에서 신호 상태로 변화 여부는 Wait\*()함수를 사용해 감지할 수 있습니다.
- 사용이 끝나면 CloseHandle() 함수를 호출합니다.

Wait*()함수는 스레드 동기화를 위한 필수 함수로, 동기화를 진행할때 비신호 -> 신호, 신호 -> 비신호 상태 변화 조건을 잘 이해해야 하며, 상황에 맞게 Wait*() 함수를 사용할 수 있어야 합니다.

### 참고자료

- [스레드 동기화](https://velog.io/@octo__/%EC%8A%A4%EB%A0%88%EB%93%9C-%EB%8F%99%EA%B8%B0%ED%99%94)
